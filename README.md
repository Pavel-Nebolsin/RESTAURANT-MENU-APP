# Y_LAB_MENU_APP

## Тесты
Для запуска приложения с ТЕСТАМИ (пустая база для pytest и postman) корневой директории в консоли выполнить:<br>
`docker-compose -f docker-compose-test.yml up -d`<br>
Когда все контейнеры запустятся, можно запустить тесты командой:<br>
`docker exec crud_tests pytest --color=yes -s -v /app/tests`<br>
(предварительно должен бы установлен <a href="https://www.docker.com/">Docker<a>)
<br>
## Celery task
Для запуска приложения с Celery[RabbitMQ] (с таской читающей excel и апдейтящей бд)<br>
в корневой директории в консоли выполнить: `docker-compose up -d`<br>
Файл `Menu.xlsx` находится в папке `admin` в контейнере с <b>Celery</b><br>
- при работе с эксель таблицей, предполагается что при добавлении новых элементов <br>
слева от них будут вписываться новые <a href="https://uuidgen.org/v/4">UUID v4<a>
- а так же предполагается что будет сохраняться правильная структура элементов
- в колонке со скидками (справа от цены) при отсутствии скидки должно быть указано `0`
- :skull_and_crossbones:осторожно, при чтении алгоритмов выполнения таски может сломаться мозг!:skull_and_crossbones:

## Дополнительно:
#### Get all:
Новый эндпоинт для получения всего содержимого бд доступен по адресу<br>
http://127.0.0.1:8000/api/v1/all_menus_with_content/<br>
#### Задания со звёздочками:
- Реализовать тестовый сценарий «Проверка кол-ва блюд и подменю в меню» из Postman с помощью pytest:<br>
   - реализовано в test_counts.py
- Реализовать вывод количества подменю и блюд для Меню через один (сложный) ORM запрос.<br>
   - изначально было реализовано, но сейчас всё разбито части для оптимизации и читаемости
- Блюда по акции. Размер скидки (%) указывается в столбце G файла Menu.xlsx
  - В Celery в файле tasks.py реализация отмечена комментарием.
#### Pre-commit хуки:
Все pre-commit хуки и линтеры проходят без ошибок.<br>
Чтобы в этом убедиться, необходимо:
- создать `виртуальное окружение` и уставновить в него все зависимости из `requirements.txt` в корневой директории реппозитория.
- далее там же инициировать `git` командой `git init`
- добавить все файлы командой `git add . `
- установить прекоммит конфиг командой `pre-commit install`
- запустить прекоммит командой `pre-commit run --all-files`
#### Работа с докером:
- Чтобы быстро кильнуть все контейнеры советую использовать команду `docker rm -f $(docker ps -aq)`
- Чтобы поднять контейнеры с учётом изменений в файлах (без кеширования) ` docker-compose up -d --build`

P.S. Истории коммитов с первой недели нет, т.к. я что-то напутал, и после этого гит не хотел комитить мёрджить и прочие страшные слова.
